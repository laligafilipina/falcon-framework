import requests
import json
#import logging
import time

class M:

    def __init__(self, td):
        self.z = td
        #logging.basicConfig(filename='app.log', filemode='a', format='%(asctime)s - %(levelname)s %(message)s', encoding='utf-8', level=logging.DEBUG)

    def gr_vir(self):
        try:
            u1 = 'https://www.virustotal.com/vtapi/v2/url/scan'
            a = '4e3202fdbe953d628f650229af5b3eb49cd46b2d3bfe5546ae3c5fa48b554e0c'
            p1 = {'apikey': a, 'url': self.z}
            r1 = requests.post(u1, data=p1)
            d = r1.json()
            r = d['resource']

            u2 = 'https://www.virustotal.com/vtapi/v2/url/report'
            p2 = {'apikey': a, 'resource': r }
            r2 = requests.get(u2, params=p2)
            gd = r2.json()

            print('\033[1;32m[+] malware scanning data requested successfully\033[0m\n\n')

            for key, value in gd['scans'].items():
                time.sleep(1)
                if value['result'] == "clean site": print("[+] %s - \033[32m %s \033[0m" % (key, value['result']))
                if value['result'] == "phishing site": print("[-] %s - \033[31m %s \033[0m" % (key, value['result']))
                if value['result'] == "malicious site": print("[-] %s - \033[31m %s \033[0m" % (key, value['result']))
            print("--- positive: [%s] --- antivirus: [%s]" % (gd['positives'], gd['total']))

        except ConnectionError:
            return "\n\033[1;31m[!] getting blocked by server too much request try again next time.\033[0m\n\n"
