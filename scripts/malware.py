import requests
import json
import time
import termcolor

class M:

    def __init__(self, td):
        self.z = td

    def gr_vir(self):
        try:
            u1 = 'https://www.virustotal.com/vtapi/v2/url/scan'
            a = '4e3202fdbe953d628f650229af5b3eb49cd46b2d3bfe5546ae3c5fa48b554e0c'
            p1 = {'apikey': a, 'url': self.z}
            r1 = requests.post(u1, data=p1)
            d = r1.json()
            r = d['resource']

            u2 = 'https://www.virustotal.com/vtapi/v2/url/report'
            p2 = {'apikey': a, 'resource': r }
            r2 = requests.get(u2, params=p2)
            gd = r2.json()
            
            bnr = "Incoming Results from API Server" 
            m = "Malware scanning result information found..."
            f = "Malware scanning failed..."
            a = termcolor.colored(bnr, color='green', attrs=['bold'])
            b = termcolor.colored(m, color='yellow', attrs=['bold'])
            d = termcolor.colored(f, color='red', attrs=['bold'])
            print('\u257E'*20,a,'\u257E'*20,'\n',b,'\n')

            for key, value in gd['scans'].items():
                time.sleep(1)
                if value['result'] == "clean site": print("[+] %s - \033[32m %s \033[0m" % (key, value['result']))
                if value['result'] == "phishing site": print("[-] %s - \033[31m %s \033[0m" % (key, value['result']))
                if value['result'] == "malicious site": print("[-] %s - \033[31m %s \033[0m" % (key, value['result']))
            print("--- positive: [%s] --- antivirus: [%s]" % (gd['positives'], gd['total']))

        except ConnectionError:
            print('\u257E'*20,'\n','d','\n')
